var BUBBLE_BORDER,BUBBLE_RADIUS,CONTAINER_BORDER,SPEED,bubbleMatrix,checkSameColor,findClosestInMatrix,getColor,getPointAtT,getPointAtY,getSlope,isMatrixLocEmpty,lookAround,stringifyLoc;BUBBLE_BORDER=5,BUBBLE_RADIUS=25,CONTAINER_BORDER=5,SPEED=20,bubbleMatrix=[],$(document).ready(function(){var t,o,r,e,a,n,i,p,u,s,l,h,d,B,c,b,f,g,x;for(B=!1,e=!1,l=$("<div class='popper-shooter'></div>"),h=$("<div id='shooter-control'></div>"),d=$("<div id='shooter-control-overlay'></div>"),a=$("<div id='gameover'></div>"),a.append("<div style='color: #300; text-align: center; font-size: 60px; margin-top: 200px'><strong>Game Over <i class='fa fa-frown-o'></i></strong></div>"),$("#popper-container").append(h),$("#popper-container").append(d),$("#popper-container").append(a),$("#popper-container").append(l),t=["red","green","yellow","blue"],s=Math.floor(Math.random()*t.length),o=t[s],r="popper-"+o,$(".popper-shooter").addClass(r),d.mousemove(function(t){var o;e||(o=(t.pageX-$(this).offset().left)/$(this).outerWidth()*160-80,$(".popper-shooter").data("rotatedeg",o),$(".popper-shooter").css("transform","rotate("+o+"deg)"),$("#shooter-rotate-deg").text("Shooter at "+Math.round(10*o)/10))}),d.bind("touchmove",function(t){var o;e||(t.preventDefault(),o=(t.originalEvent.touches[0].pageX-$(this).offset().left)/$(this).outerWidth()*160-80,o=Math.max(-80,o),o=Math.min(80,o),$(".popper-shooter").data("rotatedeg",o),$(".popper-shooter").css("transform","rotate("+o+"deg)"),$("#shooter-rotate-deg").text("Shooter at "+Math.round(10*o)/10))}),d.click(function(){var a,n;if(!B&&!e){for(n=Number($(".popper-shooter").data("rotatedeg")),$("#shoot-at-deg").text("Shoot at: "+Math.round(10*n)/10),$("#popper-container").createBubble().addClass(r).attr("data-color",o).shoot(n),a=0;a<t.length;)$(".popper-shooter").removeClass("popper-"+t[a]),a++;s=Math.floor(Math.random()*t.length),o=t[s],r="popper-"+o,$(".popper-shooter").addClass(r)}}),d.bind("touchend",function(a){var n,i;if(!B&&!e){for(a.preventDefault(),i=Number($(".popper-shooter").data("rotatedeg")),$("#shoot-at-deg").text("Shoot at: "+Math.round(10*i)/10),$("#popper-container").createBubble().addClass(r).attr("data-color",o).shoot(i),n=0;n<t.length;)$(".popper-shooter").removeClass("popper-"+t[n]),n++;s=Math.floor(Math.random()*t.length),o=t[s],r="popper-"+o,$(".popper-shooter").addClass(r)}}),c=$("#popper-container").width(),n=$("#popper-container").outerHeight()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,f=Math.floor(c/(2*BUBBLE_RADIUS)-.5),x=1.5*Math.floor(n/(2*BUBBLE_RADIUS)-.5)-1,u=(c-(f+.5)*BUBBLE_RADIUS*2)/2,bubbleMatrix=[],p=0;x>p;){for(bubbleMatrix[p]=[],i=0;f>i;)p%2===0?(b=i*BUBBLE_RADIUS*2+u,g=n):b=i*BUBBLE_RADIUS*2+BUBBLE_RADIUS+u,g=n-BUBBLE_RADIUS*p*1.7,bubbleMatrix[p][i]={x:b,y:g},i++;p++}}),getSlope=function(t){var o,r,e;return o=90-Math.abs(t),r=o*Math.PI/180,e=Math.tan(r)},getPointAtT=function(t,o){var r,e,a,n,i,p,u;return i=$("#popper-container").outerWidth()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,a=getSlope(o),p=t/Math.pow(1+a*a,.5),u=p*a,0===o?(p=0,u=t):(r=Math.ceil((p+i/2)/i),e=2*Math.floor((p/i+.5)/2),r%2===1?p-=i*e:p=i-(p-i*e),0>o&&(p=-p)),p+=i/2,u-=BUBBLE_RADIUS,n={x:p,y:u}},getPointAtY=function(t,o){var r,e,a,n;return a=$("#popper-container").outerWidth()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,r=getSlope(o),n=t/r,e=n*Math.pow(1+r*r,.5),getPointAtT(e,o)},findClosestInMatrix=function(t,o){var r,e,a,n,i,p;for(a=5e3,i={x:"",y:""},n={row:"",num:""},r=0;r<bubbleMatrix.length;){for(e=0;e<bubbleMatrix[0].length;)p=Math.pow(Math.pow(bubbleMatrix[r][e].x-t,2)+Math.pow(bubbleMatrix[r][e].y-o,2),.5),a>p&&(i.x=bubbleMatrix[r][e].x,i.y=bubbleMatrix[r][e].y,n.row=r,n.num=e,a=p),e++;r++}return n},checkSameColor=function(t,o,r){var e,a,n,i,p;if(void 0===o?o=0:o++,void 0===r&&(r=[]),r.push(stringifyLoc(t)),e=[t],1e3>o){for(a=lookAround(t),i=0,p=a.length;p>i;i++)n=a[i],-1===$.inArray(stringifyLoc(n),r)&&(r.push(stringifyLoc(n)),getColor(n)===getColor(t)&&(e=e.concat(checkSameColor(n,o,r))));return e}return console.log("too many recursions")},isMatrixLocEmpty=function(t){return t.row<0||t.row>bubbleMatrix.length-1||t.num<0||t.num>bubbleMatrix[0].length-1?!0:void 0===bubbleMatrix[t.row][t.num].div},stringifyLoc=function(t){return t.row+","+t.num},getColor=function(t,o){return void 0===t.row?bubbleMatrix[t][o].color:bubbleMatrix[t.row][t.num].color},lookAround=function(t){var o,r,e,a,n,i,p,u,s;for(r=$(this[0]),p=t.row,i=t.num,e=[],o=p%2===0?-1:0,e.push({row:p-1,num:i+o}),e.push({row:p-1,num:i+o+1}),e.push({row:p,num:i-1}),e.push({row:p,num:i+1}),e.push({row:p+1,num:i+o}),e.push({row:p+1,num:i+o+1}),a=[],u=0,s=e.length;s>u;u++)n=e[u],isMatrixLocEmpty(n)||a.push(n);return a},jQuery.fn.createBubble=function(){var t;return t=$("<div class='point'></div>"),t.css("width",2*BUBBLE_RADIUS+"px").css("height",2*BUBBLE_RADIUS+"px").css("border-width",BUBBLE_BORDER+"px"),$(this[0]).append(t),t},jQuery.fn.putInMatrix=function(t){var o,r;r=$(this[0]),bubbleMatrix[t.row][t.num].div=r,bubbleMatrix[t.row][t.num].color=r.attr("data-color"),o=bubbleMatrix[t.row][t.num],r.drawAt(o.x,o.y),r.attr("data-matrow",t.row),r.attr("data-matnum",t.num),r.text(t.row+", "+t.num)},jQuery.fn.drawAt=function(t,o){$(this[0]).show().css("bottom",o+"px").css("left",+t+"px")},jQuery.fn.shoot=function(t){var o,r,e,a,n;return r=$(this[0]),clearInterval(window.shootInterval),a={row:"",num:""},e=$("#popper-container").outerHeight()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,n=0,o=0,window.shootInterval=setInterval(function(){var i,p,u,s,l;l=!0,s=getPointAtT(n,t),s.y<=e?(p=findClosestInMatrix(s.x,s.y),isMatrixLocEmpty(p)?(o%2===0&&r.drawAt(s.x,s.y),a=p,n+=SPEED):(clearInterval(window.shootInterval),l=!1,a.row>8?($("#gameover").show(),u=!0,r.remove()):r.putInMatrix(a))):(clearInterval(window.shootInterval),l=!1,i=getPointAtY(e+BUBBLE_RADIUS,t),p=findClosestInMatrix(i.x,i.y),r.putInMatrix(isMatrixLocEmpty(p)?p:a))},5),r};