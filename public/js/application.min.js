var ADDROW_TIMER_CEILING,ADDROW_TIMER_MIN,ADDROW_TIMER_MULTIPLIER,BUBBLE_BORDER,BUBBLE_OPTIONS,BUBBLE_RADIUS,CONTAINER_BORDER,DEFAULT_ROWS,DROP_MULTIPLER,DROP_TIME_MULTIPLER,MAX_ANGLE,MAX_ROW_NUM,NUM_PER_ROW,ROW_TURNS_CEILING,ROW_TURNS_FLOOR,ROW_TURNS_MULTIPLIER,ROW_TURNS_RAND,SPEED,addRow,addRowCounter,addRowCounterSecs,addRows,addToScore,addToScrewQueue,auth,autoLogIn,bubbleMatrix,bubbleMatrixOne,bubbleMatrixTwo,checkCluster,checkIfWon,currMatrix,drop,fb,findClosestInMatrix,getColor,getDivFromLoc,getPointAtT,getPointAtY,getSlope,getUrlParam,isLoggedIn,isLost,isMatrixLocEmpty,isMultiPlayer,isPaused,isWon,lookAround,lose,matchID,moveBubble,myPlayerNum,noticeFlash,numRowAdded,opponentID,pause,scoochAllDown,screwQueue,shooting,stringifyLoc,syncBoard,toggleMatrixPosition,unpause,user,win;NUM_PER_ROW=10,BUBBLE_OPTIONS=["red","green","yellow","blue"],DEFAULT_ROWS=3,MAX_ROW_NUM=10,SPEED=20,MAX_ANGLE=75,ROW_TURNS_CEILING=0,ROW_TURNS_FLOOR=3,ROW_TURNS_RAND=2,ROW_TURNS_MULTIPLIER=0,ADDROW_TIMER_CEILING=20,ADDROW_TIMER_MIN=5,ADDROW_TIMER_MULTIPLIER=.95,DROP_MULTIPLER=1.2,DROP_TIME_MULTIPLER=2.5,getUrlParam=function(t){var r,e;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=r.exec(location.search),null==e?"":decodeURIComponent(e[1].replace(/\+/g," ").replace(/\//g,""))},""!==getUrlParam("num")&&(NUM_PER_ROW=parseFloat(getUrlParam("num"))),""!==getUrlParam("maxrows")&&(MAX_ROW_NUM=parseFloat(getUrlParam("maxrows"))),""!==getUrlParam("startrows")&&(DEFAULT_ROWS=parseFloat(getUrlParam("startrows"))),""!==getUrlParam("speed")&&(SPEED=parseFloat(getUrlParam("speed"))),""!==getUrlParam("angle")&&(MAX_ANGLE=parseFloat(getUrlParam("angle"))),""!==getUrlParam("turnmax")&&(ROW_TURNS_CEILING=parseFloat(getUrlParam("turnmax"))),""!==getUrlParam("turnmin")&&(ROW_TURNS_FLOOR=parseFloat(getUrlParam("turnmin"))),""!==getUrlParam("turnrand")&&(ROW_TURNS_RAND=parseFloat(getUrlParam("turnrand"))),""!==getUrlParam("turnaccel")&&(ROW_TURNS_MULTIPLIER=parseFloat(getUrlParam("turnaccel"))),""!==getUrlParam("timermax")&&(ADDROW_TIMER_CEILING=parseFloat(getUrlParam("timermax"))),""!==getUrlParam("timermin")&&(ADDROW_TIMER_MIN=parseFloat(getUrlParam("timermin"))),""!==getUrlParam("timeraccel")&&(ADDROW_TIMER_MULTIPLIER=parseFloat(getUrlParam("timeraccel"))),""!==getUrlParam("droppoints")&&(DROP_MULTIPLER=parseFloat(getUrlParam("droppoints"))),""!==getUrlParam("droptime")&&(DROP_TIME_MULTIPLER=parseFloat(getUrlParam("droptime"))),BUBBLE_BORDER=5,BUBBLE_RADIUS=25,CONTAINER_BORDER=5,shooting=!1,isLost=!1,isPaused=!0,isWon=!1,currMatrix="",bubbleMatrix=[],bubbleMatrixOne=[],bubbleMatrixTwo=[],addRowCounter=0,addRowCounterSecs=1,numRowAdded=0,isMultiPlayer=!1,screwQueue=[],myPlayerNum=0,fb=new Firebase("https://pop-it.firebaseio.com/"),user="",isLoggedIn=!1,autoLogIn=!0,opponentID=void 0,matchID=void 0,auth=new FirebaseSimpleLogin(fb,function(t,r){var e,o,a,n,i,s;return t?console.log("Firebase error: "+t):r?(user=r,console.log("Anonymouse User "+r.id),fb.child("players").once("value",function(t){return null===t.child(user.id).val()?fb.child("players").child(user.id).set(user.id):void 0}),o=getUrlParam("m"),""!==o&&(a=fb.child("matches").child(o),a.on("value",function(t){var r,e;if(null!==t.val()&&(void 0===t.val().winner||""===t.val().winner?t.val().player1_id===user.id?(console.log("You are Player 1!"),isMultiPlayer=!0,matchID=o,$("#startscreen").find(".startplaying").text("Start Match"),myPlayerNum=1,void 0===t.val().player2_id?$("#startscreen").find(".startplaying").addClass("disabled").text("waiting for opponent"):(opponentID=t.val().player2_id,$("#startscreen").find(".startplaying").removeClass("disabled").text("Start Match"),a.off("value"),s(opponentID))):void 0===t.val().player2_id||t.val().player2_id===user.id?(a.child("player2_id").set(user.id),isMultiPlayer=!0,matchID=o,console.log("You are Player 2!"),$("#startscreen").find(".startplaying").text("Start Match"),myPlayerNum=2,opponentID=t.val().player1_id,a.off("value"),s(opponentID)):($("#startscreen").find(".startplaying").addClass("disabled").text("Match Full"),a.off("value")):$("#startscreen").hide()),isMultiPlayer===!0){for(syncBoard(),clearInterval(window.addrow),$("#timer-container").hide(),$("#startscreen").find("#rowintervalinfo").hide(),$("#startscreen").find("#rowcounterinfo").hide(),ROW_TURNS_CEILING=0,ADDROW_TIMER_CEILING=0,e=$("<div class='screwqueue-container'><div>Send when full</div></div>"),r=0;NUM_PER_ROW>r;)e.append("<div class='screwqueue-ball screwqueue-"+r+"'></div>"),r++;return $("#popper-container").append(e)}}),n=fb.child("matches").child(o).child("transit"),n.on("child_added",function(t){return null!==t.val()&&(window.dv=t.val(),t.val().to===user.id)?(addRow(t.val().addrow,"You got a gift"),n.child(t.name()).child("status").set("done")):void 0}),i=function(t){var r,e,o,a,n,i,s,l,u,d,c,p;for(l=.2,a=2*BUBBLE_RADIUS*l,$("#oppboard-container").remove(),s=$("<div style='position: absolute; right: 5px; bottom: 5px; border: solid 1px #BFBFBF; background: #D5D5D5' id='oppboard'></div>"),s.css("width",600*l+"px").css("height",600*l+"px"),$("#popper-container").append(s),c=t.board,p=[],u=0,d=c.length;d>u;u++)o=c[u],i=o[0]*l,r=o[1]*l,e=o[2],n=$("<div></div>"),n.addClass("popper-"+e),n.css("position","absolute").css("border-radius","20px").css("border","solid 1px #BFBFBF"),n.css("left",i+"px").css("bottom",r+"px").width(a+"px").height(a+"px"),p.push(s.append(n));return p},s=function(t){var r;return r=fb.child("matches").child(o).child("players").child(t),r.on("value",function(t){return i(t.val())})},e=fb.child("matches").child(o).child("winner"),e.on("value",function(t){return void 0!==t.val()&&""!==t.val()?t.val()===user.id?win():lose():void 0})),$("#startscreen").css("color","#888")):(autoLogIn&&auth.login("anonymous",{rememberMe:!0}),$("#startscreen").css("color","#888")),$(".startplaying").show()}),$(document).ready(function(){var t,r,e,o,a,n,i,s,l,u,d,c,p,h,b,m,R,M,w,_,f,I,g,v,B,E;for(m=$("<div class='popper-shooter'></div>"),M=$("<div id='shooter-control'></div>"),R=$("<div id='shooter-base'></div>"),0!==ROW_TURNS_CEILING?(e=0!==ROW_TURNS_MULTIPLIER?"<br>...for now":"",l=1!==ROW_TURNS_RAND?Math.ceil(ROW_TURNS_CEILING/ROW_TURNS_RAND)+" to ":"",h="<span id='rowcounterinfo'>New row every "+l+ROW_TURNS_CEILING+" turns"+e+".<br><br></span>"):h="",0!==ADDROW_TIMER_CEILING?(e=1>ADDROW_TIMER_MULTIPLIER?"<br>...for now":"",b="<span id='rowintervalinfo'>New row every "+ADDROW_TIMER_CEILING+" secs"+e+".<br><br></span>"):b="",_=$("<div id='startscreen' class='overlay' style='color: transparent'></div>"),_.append("<p>Clear the board.<br /><br />\nConnect 3 or more of the similar colors to POP them.<br /><br /> "+h+b+'<button class="btn btn-primary btn-large startplaying" style="display:none">Start Playing</button><br />\n<span class="startmatch-container" style="font-size: 16px; font-weight: normal">or <a href="javascript:void(0)" class="startmatch-btn">start a match</a></span>\n</p>'),o=$("<div id='gameover' class='overlay'></div>"),o.append('<p>Game Over <i class=\'fa fa-frown-o\'></i><br /><br />\n  <button class="btn btn-primary btn-large startplaying" style="display:none">Start Playing</button><br />\n  <span class="startmatch-container" style="font-size: 16px; font-weight: normal">or <a href="javascript:void(0)" class="startmatch-btn">start a match</a></span>\n</p>'),d=$("<div id='pause' class='overlay'></div>"),d.append("<p>Paused. o_O</p>"),I=$("<div id='victory' class='overlay'></div>"),I.append('<p>VICTORY! <i class=\'fa fa-smile-o\'></i><br /><br />\n  <button class="btn btn-primary btn-large startplaying" style="display:none">Start Playing</button><br />\n  <span class="startmatch-container" style="font-size: 16px; font-weight: normal">or <a href="javascript:void(0)" class="startmatch-btn">start a match</a></span>\n</p>'),u=$("<div id='notice-overlay'></div>"),w=$("<div id='shooter-control-overlay'></div>"),$("#popper-container").append(M),$("#popper-container").append(R),$("#popper-container").append(w),$("#popper-container").append(o),$("#popper-container").append(d),$("#popper-container").append(I),$("#popper-container").append(m),$("#popper-container").append(u),$("#popper-container").append(_),"true"===getUrlParam("start")&&($("#startscreen").hide(),unpause(),$("#popper-container").css("cursor","none")),c=Math.floor(Math.random()*BUBBLE_OPTIONS.length),t=BUBBLE_OPTIONS[c],r="popper-"+t,$(".popper-shooter").addClass(r),w.mousemove(function(t){var r;isLost||isPaused||isWon||(r=(t.pageX-$(this).offset().left)/$(this).outerWidth()*160-MAX_ANGLE,r=Math.max(-MAX_ANGLE,r),r=Math.min(MAX_ANGLE,r),$(".popper-shooter").data("rotatedeg",r),$(".popper-shooter").css("transform","rotate("+r+"deg)"),$("#shooter-rotate-deg").text("Shooter at "+Math.round(10*r)/10))}),w.bind("touchmove",function(t){var r;isLost||isPaused||isWon||(t.preventDefault(),r=(t.originalEvent.touches[0].pageX-$(this).offset().left)/$(this).outerWidth()*160-MAX_ANGLE,r=Math.max(-MAX_ANGLE,r),r=Math.min(MAX_ANGLE,r),$(".popper-shooter").data("rotatedeg",r),$(".popper-shooter").css("transform","rotate("+r+"deg)"),$("#shooter-rotate-deg").text("Shooter at "+Math.round(10*r)/10))}),w.click(function(){var e,o;if(!(shooting||isLost||isPaused||isWon)){for(o=Number($(".popper-shooter").data("rotatedeg")),$("#shoot-at-deg").text("Shoot at: "+Math.round(10*o)/10),$("#popper-container").createBubble().addClass(r).attr("data-color",t).shoot(o),0!==ROW_TURNS_CEILING&&(addRowCounter+=Math.floor(Math.random()*ROW_TURNS_RAND)+1,addRowCounter>=Math.max(ROW_TURNS_FLOOR,ROW_TURNS_CEILING-ROW_TURNS_MULTIPLIER*numRowAdded)&&(addRow(),numRowAdded++,addRowCounter=0)),e=0;e<BUBBLE_OPTIONS.length;)$(".popper-shooter").removeClass("popper-"+BUBBLE_OPTIONS[e]),e++;c=Math.floor(Math.random()*BUBBLE_OPTIONS.length),t=BUBBLE_OPTIONS[c],r="popper-"+t,$(".popper-shooter").addClass(r)}}),w.bind("touchend",function(e){var o,a;if(!(shooting||isLost||isPaused||isWon)){for(e.preventDefault(),a=Number($(".popper-shooter").data("rotatedeg")),$("#shoot-at-deg").text("Shoot at: "+Math.round(10*a)/10),$("#popper-container").createBubble().addClass(r).attr("data-color",t).shoot(a),0!==ROW_TURNS_CEILING&&(addRowCounter+=Math.floor(Math.random()*ROW_TURNS_RAND)+1,addRowCounter>ROW_TURNS_CEILING-ROW_TURNS_MULTIPLIER*numRowAdded&&(addRow(),numRowAdded++,addRowCounter=0)),o=0;o<BUBBLE_OPTIONS.length;)$(".popper-shooter").removeClass("popper-"+BUBBLE_OPTIONS[o]),o++;return c=Math.floor(Math.random()*BUBBLE_OPTIONS.length),t=BUBBLE_OPTIONS[c],r="popper-"+t,$(".popper-shooter").addClass(r)}}),f=$("#popper-container").width(),a=$("#popper-container").outerHeight()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,v=Math.floor(f/(2*BUBBLE_RADIUS)-.5),NUM_PER_ROW>0&&(v=NUM_PER_ROW),E=1.5*Math.floor(a/(2*BUBBLE_RADIUS)-.5)-1,s=(f-(v+.5)*BUBBLE_RADIUS*2)/2,bubbleMatrixOne=[],bubbleMatrix=[],i=0;E>i;){for(bubbleMatrixOne[i]=[],bubbleMatrix[i]=[],n=0;v>n;)i%2===0?(g=n*BUBBLE_RADIUS*2+s,B=a):g=n*BUBBLE_RADIUS*2+BUBBLE_RADIUS+s,B=a-BUBBLE_RADIUS*i*1.7,bubbleMatrixOne[i][n]={x:g,y:B},bubbleMatrix[i][n]={x:g,y:B},n++;i++}for(currMatrix="one",bubbleMatrixTwo=[],i=0;E>i;){for(bubbleMatrixTwo[i]=[],n=0;v>n;)i%2===1?(g=n*BUBBLE_RADIUS*2+s,B=a):g=n*BUBBLE_RADIUS*2+BUBBLE_RADIUS+s,B=a-BUBBLE_RADIUS*i*1.7,bubbleMatrixTwo[i][n]={x:g,y:B},n++;i++}return 0===ADDROW_TIMER_CEILING?($("#timer-container").hide(),addRowCounterSecs=1):($("#timer-container").show(),$("#addrowmeter").css("width","100%"),$("#timer").text(ADDROW_TIMER_CEILING).show(),addRowCounterSecs=ADDROW_TIMER_CEILING,p=.1,window.addrow=setInterval(function(){return isPaused===!1?($("#timer").text(Math.max(0,Math.floor(addRowCounterSecs))),$("#addrowmeter").css("width",(addRowCounterSecs-1*p)/ADDROW_TIMER_CEILING*100+"%"),0>addRowCounterSecs&&(addRow(),numRowAdded++,addRowCounterSecs=Math.max(ADDROW_TIMER_MIN,ADDROW_TIMER_CEILING*Math.pow(ADDROW_TIMER_MULTIPLIER,numRowAdded))),addRowCounterSecs-=1*p):void 0},1e3*p)),addRows(DEFAULT_ROWS),$("#pause-button").click(function(){return isPaused===!1?(pause(),$(this).text("Go")):(unpause(),$(this).text("Pause"))}),$(".startplaying").click(function(){return isWon||isLost?window.location="?start=true":($("#startscreen").hide(),unpause(),$("#popper-container").css("cursor","none"))}),$(".startmatch-btn").click(function(){var t;return t=fb.child("matches").push(),t.child("created_on").set(Firebase.ServerValue.TIMESTAMP),t.child("player1_id").set(user.id),t.child("winner").set(""),$(".startmatch-container").html("<span style='font-size: 14px; font-weight: normal'>link to match: <input type='text' value='"+window.location.origin+"/?m="+t.name()+"' /></span>")})}),noticeFlash=function(t){return $("#notice-overlay").html(t).show().fadeOut({duration:1500})},getSlope=function(t){var r,e,o;return r=90-Math.abs(t),e=r*Math.PI/180,o=Math.tan(e)},getPointAtT=function(t,r){var e,o,a,n,i,s,l;return i=$("#popper-container").outerWidth()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,a=getSlope(r),s=t/Math.pow(1+a*a,.5),l=s*a,0===r?(s=0,l=t):(e=Math.ceil((s+i/2)/i),o=2*Math.floor((s/i+.5)/2),e%2===1?s-=i*o:s=i-(s-i*o),0>r&&(s=-s)),s+=i/2,l-=BUBBLE_RADIUS,n={x:s,y:l}},getPointAtY=function(t,r){var e,o,a,n;return a=$("#popper-container").outerWidth()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,e=getSlope(r),n=t/e,o=n*Math.pow(1+e*e,.5),getPointAtT(o,r)},findClosestInMatrix=function(t,r){var e,o,a,n,i,s;for(a=5e3,i={x:"",y:""},n={row:"",num:""},e=0;e<bubbleMatrix.length;){for(o=0;o<bubbleMatrix[0].length;)s=Math.pow(Math.pow(bubbleMatrix[e][o].x-t,2)+Math.pow(bubbleMatrix[e][o].y-r,2),.5),a>s&&(i.x=bubbleMatrix[e][o].x,i.y=bubbleMatrix[e][o].y,n.row=e,n.num=o,a=s),o++;e++}return n},syncBoard=function(){var t,r;return isMultiPlayer?(t=[],$(".point").each(function(){var r,e,o;return o=parseFloat($(this).css("left")),r=parseFloat($(this).css("bottom")),e=$(this).data("color"),t.push([o,r,e])}),r=fb.child("matches").child(matchID).child("players").child(user.id).child("board").set(t)):void 0},addRows=function(t){var r,e;for(r=0,e=[];t>r;)addRow(),e.push(r++);return e},addRow=function(t,r){var e,o,a,n,i,s,l,u,d,c,p;if(!isWon&&!isLost){if(scoochAllDown(),void 0===t)for(t=[],p=bubbleMatrix[0],l=0,d=p.length;d>l;l++)a=p[l],s=Math.floor(Math.random()*BUBBLE_OPTIONS.length),t.push(BUBBLE_OPTIONS[s]);else if(t.length<bubbleMatrix[0].length)for(a=t.length;a<bubbleMatrix[0].length;)s=Math.floor(Math.random()*BUBBLE_OPTIONS.length),t.push(BUBBLE_OPTIONS[s]),a++;for(i=0,u=0,c=t.length;c>u;u++)e=t[u],o=$("#popper-container").createBubble(e).addClass("popper-"+e).text("0,"+i),n={row:0,num:i},o.putInMatrix(n,!1),o.hide().fadeIn({duration:200}),i++;if(void 0!==r&&noticeFlash(r),isMultiPlayer)return syncBoard()}},scoochAllDown=function(t){var r,e,o;for(r=0,e=!1,o=bubbleMatrix.length;o>0;)for(o--,t=bubbleMatrix[o].length;t>0;)t--,isMatrixLocEmpty({row:o,num:t})||(moveBubble({row:o,num:t},{row:o+1,num:t}),e===!1&&(e=!0,r=o+1));return toggleMatrixPosition(),r>MAX_ROW_NUM?lose():void 0},moveBubble=function(t,r){var e;return e=getDivFromLoc(t),e.attr("data-matrow",r.row).attr("data-matnum",r.num),e.css("bottom",bubbleMatrix[r.row][r.num].y),e.css("left",bubbleMatrix[r.row][r.num].x),e.text(r.row+","+r.num),bubbleMatrix[r.row][r.num].div=bubbleMatrix[t.row][t.num].div,bubbleMatrix[r.row][r.num].color=bubbleMatrix[t.row][t.num].color,bubbleMatrix[t.row][t.num].div=void 0,bubbleMatrix[t.row][t.num].color=void 0},toggleMatrixPosition=function(){var t,r,e,o;for("one"===currMatrix?(t=bubbleMatrixTwo,currMatrix="two"):(t=bubbleMatrixOne,currMatrix="one"),o=0;o<t.length;){for(e=0;e<t[o].length;)bubbleMatrix[o][e].x=t[o][e].x,bubbleMatrix[o][e].y=t[o][e].y,isMatrixLocEmpty({row:o,num:e})||(r=$(".point[data-matrow='"+o+"'][data-matnum='"+e+"']"),r.css("left",t[o][e].x+"px").css("bottom",t[o][e].y)),e++;o++}},checkCluster=function(t,r,e,o){var a,n,i,s,l;if(void 0===r&&(r=!0),void 0===e?e=0:e++,void 0===o&&(o=[]),o.push(stringifyLoc(t)),a=[t],1e3>e){for(n=lookAround(t),s=0,l=n.length;l>s;s++)i=n[s],-1===$.inArray(stringifyLoc(i),o)&&(o.push(stringifyLoc(i)),r?getColor(i)===getColor(t)&&(a=a.concat(checkCluster(i,r,e,o))):a=a.concat(checkCluster(i,r,e,o)));return a}},isMatrixLocEmpty=function(t){return t.row<0||t.row>bubbleMatrix.length-1||t.num<0||t.num>bubbleMatrix[0].length-1?!0:void 0===bubbleMatrix[t.row][t.num].div},stringifyLoc=function(t){return t.row+","+t.num},getColor=function(t,r){return void 0===t.row?bubbleMatrix[t][r].color:bubbleMatrix[t.row][t.num].color},lookAround=function(t){var r,e,o,a,n,i,s,l,u;for(e=$(this[0]),s=t.row,i=t.num,o=[],r="one"===currMatrix?s%2===0?-1:0:s%2===1?-1:0,o.push({row:s-1,num:i+r}),o.push({row:s-1,num:i+r+1}),o.push({row:s,num:i-1}),o.push({row:s,num:i+1}),o.push({row:s+1,num:i+r}),o.push({row:s+1,num:i+r+1}),a=[],l=0,u=o.length;u>l;l++)n=o[l],isMatrixLocEmpty(n)||a.push(n);return a},drop=function(t,r,e){var o,a,n,i,s,l,u,d,c,p,h;if(void 0!==t){if(t instanceof Array){if(0===t.length)return;t=t}else t=[t];for("drop"===r&&(c=_.min(t,function(t){return t.row}),u=c.row,d=bubbleMatrix[u][0].y-$("#popper-container").height()),a=0,p=0,h=t.length;h>p;p++)n=t[p],bubbleMatrix[n.row][n.num].color=void 0,bubbleMatrix[n.row][n.num].div=void 0,i=getDivFromLoc(n),"drop"===r?(l=d,s=Math.pow(n.row-u+1,1.1),o=-50*s,l+=o,a===t.length-1?i.animate({bottom:l+"px"},{duration:600,complete:function(){return void 0!==e&&e(),$(this).remove()}}):i.animate({bottom:l+"px"},{duration:600,complete:function(){return $(this).remove()}})):i.fadeOut(a===t.length-1?{duration:150,complete:function(){return void 0!==e&&setTimeout(function(){return e()},10),$(this).remove()}}:{duration:150,complete:function(){return $(this).remove()}}),a++}},getDivFromLoc=function(t){var r;return r=$(".point[data-matrow="+t.row+"][data-matnum="+t.num+"]")},lose=function(){return $("#gameover").show(),isLost=!0,clearInterval(window.addrow),shooting=!1,$("#pause-button").addClass("disabled"),isMultiPlayer&&fb.child("matches").child(matchID).child("winner").set(opponentID),$(".startmatch-btn").show(),$(".startplaying").show(),$("#popper-container").css("cursor","auto")},pause=function(){return $("#pause").show(),isPaused=!0,$("#popper-container").css("cursor","auto")},unpause=function(){return $("#pause").hide(),isPaused=!1,$("#popper-container").css("cursor","none")},win=function(){return $("#victory").show(),clearInterval(window.addrow),isWon=!0,shooting=!1,$("#pause-button").addClass("disabled"),$(".startmatch-btn").show(),$(".startplaying").show(),$("#popper-container").css("cursor","auto")},checkIfWon=function(){var t,r,e,o;for(t=!0,o=0;o<bubbleMatrix.length;){for(e=0;e<bubbleMatrix[o].length;){if(r={row:o,num:e},!isMatrixLocEmpty(r)){t=!1;break}e++}o++}return t},addToScore=function(t){var r,e;return e=parseInt($("#score").text()),r=e+t,10>r?$("#score").text("0000"+r):r>=10?$("#score").text("000"+r):r>=100?$("#score").text("00"+r):r>=1e3?$("#score").text("0"+r):r>=1e4?$("#score").text(r):($("#score").text(r),$("#score-container").css("font-size","28px"))},addToScrewQueue=function(t,r){var e,o,a,n,i,s,l,u;for(u=[],n=0,s=t.length;s>n;n++){if(a=t[n],"locs"===r?o=bubbleMatrix[a.row][a.num].color:"colors"===r&&(o=a),screwQueue.push(o),$(".screwqueue-"+(screwQueue.length-1)).addClass("popper-"+o),10===screwQueue.length)for(fb.child("matches").child(matchID).child("transit").push({from:user.id,to:opponentID,addrow:screwQueue}),screwQueue=[],i=0,l=BUBBLE_OPTIONS.length;l>i;i++)e=BUBBLE_OPTIONS[i],$(".screwqueue-ball").removeClass("popper-"+e);u.push($("#screwqueue-length").text(screwQueue.length))}return u},jQuery.fn.createBubble=function(t){var r;return r=$("<div class='point'></div>"),r.css("width",2*BUBBLE_RADIUS+"px").css("height",2*BUBBLE_RADIUS+"px").css("border-width",BUBBLE_BORDER+"px"),void 0!==t&&r.attr("data-color",t),$(this[0]).append(r),r},jQuery.fn.putInMatrix=function(t,r){var e,o,a,n,i,s,l,u,d;if(void 0===r&&(r=!0),n=$(this[0]),bubbleMatrix[t.row][t.num].div=n,bubbleMatrix[t.row][t.num].color=n.attr("data-color"),o=bubbleMatrix[t.row][t.num],n.drawAt(o.x,o.y),n.attr("data-matrow",t.row),n.attr("data-matnum",t.num),n.text(t.row+", "+t.num),r===!0)if(a=0,u=checkCluster(t,!0),u.length>=3){if(addToScore(u.length),isMultiPlayer){for(s=Math.floor(u.length/2),i=0,d=[];s>i;)i++,l=Math.floor(Math.random()*BUBBLE_OPTIONS.length),e=BUBBLE_OPTIONS[l],d.push(e);addToScrewQueue(d,"colors")}drop(u,"fade",function(){var t,r,e,o,a,n,s,l,u,d,c,p,h,b,m;for(c=[],i=0,m=bubbleMatrix[0],h=0,b=m.length;b>h;h++)t=m[h],c.push(i),i++;for(p=[],i=0;i<c.length&&1e3>i;)n={row:0,num:i},isMatrixLocEmpty(n)?i++:(p=p.concat(checkCluster(n,!1)),o=_.max(_.where(p,{row:0}),function(t){return t.num}),i=o.num+1);for(s=[],d=0;d<bubbleMatrix.length;){for(l=0;l<bubbleMatrix[d].length;)a={row:d,num:l},isMatrixLocEmpty(a)||0===_.where(p,a).length&&s.push(a),l++;d++}return s.length>0&&(e=Math.round(s.length*DROP_TIME_MULTIPLER),u=addRowCounterSecs+e,u=Math.min(u,ADDROW_TIMER_CEILING),addRowCounterSecs=u,$("#addrowmeter").css("width",addRowCounterSecs/ADDROW_TIMER_CEILING*100+"%")),s.length>0?(r=Math.ceil(Math.pow(s.length,DROP_MULTIPLER)),r>1?noticeFlash("<small>Dropped "+s.length+"!</small><br />"+r+" bonus points!!"):1===r&&noticeFlash("<small>Dropped 1</small><br />"+r+" bonus point!")):r=0,addToScore(s.length+r),isMultiPlayer&&addToScrewQueue(s,"locs"),drop(s,"drop",function(){return checkIfWon()===!0&&win(),syncBoard()}),checkIfWon()===!0&&win(),0===s.length?syncBoard():void 0})}else t.row>MAX_ROW_NUM&&(lose(),n=$(".point").last(),n.css("background-color","#DDD").css("border-color","#BBB")),syncBoard();shooting=!1},jQuery.fn.drawAt=function(t,r){$(this[0]).show().css("bottom",r+"px").css("left",+t+"px")},jQuery.fn.shoot=function(t){var r,e,o,a,n;return e=$(this[0]),clearInterval(window.shootInterval),a={row:"",num:""},o=$("#popper-container").outerHeight()-2*BUBBLE_RADIUS-2*BUBBLE_BORDER,n=0,r=0,window.shootInterval=setInterval(function(){var i,s,l;shooting=!0,l=getPointAtT(n,t),l.y<=o?(s=findClosestInMatrix(l.x,l.y),isMatrixLocEmpty(s)?(r%2===0&&e.drawAt(l.x,l.y),a=s,n+=SPEED):(clearInterval(window.shootInterval),e.putInMatrix(a))):(clearInterval(window.shootInterval),i=getPointAtY(o+BUBBLE_RADIUS,t),s=findClosestInMatrix(i.x,i.y),e.putInMatrix(isMatrixLocEmpty(s)?s:a))},5),e};